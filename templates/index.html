{% extends "base.html" %}

{% block title %}Cockpit Argus Prime{% endblock %}

{% block content %}
<input type="hidden" id="last-user-query" value="">

<div id="vanta-bg" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;"></div>

<div class="grid-container" style="grid-template-columns: 1fr; background: transparent;"> 
    <main class="main-content" style="max-width: 900px; margin: 0 auto; width: 100%;">
        
        <div class="brain-selector" id="brain-container" style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
            <button class="brain-btn" id="btn-operator" onclick="manualSwitch('operator')">‚öôÔ∏è Operator</button> 
            <button class="brain-btn" id="btn-architect" onclick="manualSwitch('architect')">üéì Architect</button>
            <button class="brain-btn" id="btn-strategist" onclick="manualSwitch('strategist')">üíº Strategist</button>
            <button class="brain-btn" id="btn-polymath" onclick="manualSwitch('polymath')">‚òï Polymath</button>
        </div>

        <div class="daily-focus-card" style="text-align: center; background: transparent; border: none; box-shadow: none;">
            <h2 id="brain-title" style="text-shadow: 0 0 10px rgba(255,255,255,0.5);">{{ brain_name }} Online</h2>
            <p class="focus-desc" id="status-line">Conectado. C√©rebro: {{ brain_name }}</p>
        </div>
        
        <div class="interaction-area" style="background: transparent;">
            <div id="chatHistory" class="chat-history" style="height: 60vh; overflow-y: auto; padding: 10px;"></div>
        </div>

        <div class="chat-input-wrapper" style="display: flex; gap: 10px; margin-top: 10px;">
            <input type="text" id="userMsg" placeholder="Comando para o Argus..." autocomplete="off" autofocus style="flex: 1; padding: 15px; border-radius: 10px; border: 1px solid #444; background: rgba(0,0,0,0.5); color: white;">
            <button id="btnSend" onclick="sendMessage()" style="padding: 0 20px; border-radius: 10px; border: none; background: #00ff00; color: black; font-weight: bold; cursor: pointer;">‚û§</button>
        </div>

    </main>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.net.min.js"></script>

<script src="{{ url_for('static', filename='script.js') }}"></script>

<script>
    window.addEventListener('load', function() {
        try {
            // Pega a cor do Flask
            let colorHex = "{{ brain_color }}";
            let colorInt = 0x3f99ff;
            
            if (colorHex && colorHex !== "None") {
                if(colorHex.startsWith('#')) colorInt = parseInt(colorHex.replace('#', '0x'));
                else colorInt = parseInt(colorHex);
            }

            // Inicia o Vanta GLOBALMENTE
            if (typeof VANTA !== 'undefined') {
                vantaEffect = VANTA.NET({
                    el: "#vanta-bg",
                    mouseControls: true, touchControls: true, gyroControls: false,
                    minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00,
                    color: colorInt,
                    backgroundColor: 0x050505,
                    points: 12.00, maxDistance: 22.00, spacing: 16.00
                });
            }
        } catch(e) {
            console.warn("Erro ao iniciar Vanta (Check se Three.js est√° carregado):", e);
        }
    });
</script>

{% endblock %}